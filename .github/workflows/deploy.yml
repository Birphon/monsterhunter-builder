name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # Trigger deployment when changes are pushed to the main branch

permissions:
  contents: write  # This is important - it gives the workflow permission to write to your repository

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: 'npm'  # Add caching for faster builds

    - name: Debug information
      run: |
        echo "Repository: ${{ github.repository }}"
        echo "Ref: ${{ github.ref }}"
        echo "Working directory contents:"
        ls -la

    - name: Install dependencies
      run: npm ci  # More reliable than npm install for CI environments
      
    - name: Debug after npm install
      run: |
        echo "Node modules installed:"
        ls -la node_modules | head -n 10
        echo "Package.json scripts:"
        cat package.json | grep -A 10 '"scripts"'

    - name: Build project
      run: npm run build  # Assuming this builds to a 'dist' directory
      
    - name: Debug build output
      run: |
        echo "Build directory contents:"
        if [ -d "dist" ]; then
          ls -la dist
          echo "Number of files in dist:"
          find dist -type f | wc -l
        else
          echo "dist directory not found!"
          echo "Current directory contains:"
          ls -la
          echo "Looking for potential build outputs:"
          find . -maxdepth 2 -type d -name "build" -o -name "public" -o -name "out"
        fi

    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        folder: dist  # The folder the action should deploy
        branch: gh-pages  # The branch the action should deploy to
        clean: true  # Automatically remove deleted files from the deploy branch
        commit-message: "Deploy from GitHub Actions"  # Custom commit message
